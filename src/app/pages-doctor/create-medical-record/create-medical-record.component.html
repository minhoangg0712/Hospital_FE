<div class="container">
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fas fa-file-medical"></i> Tạo hồ sơ bệnh án</h1>
      <div class="patient-info" *ngIf="patientInfo">
        <div class="patient-avatar">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="patient-details">
          <h3>{{patientInfo.name}}</h3>
          <p>Mã bệnh nhân: {{patientId}}</p>
          <!-- Ẩn phần hiển thị thông tin người thân -->
          <!-- <div class="relative-info" *ngIf="appointment?.relativeName">
            <p><i class="fas fa-users"></i> Người thân: {{appointment?.relativeName}}</p>
            <p><i class="fas fa-id-card"></i> CCCD: {{appointment?.relativeIdCard}}</p>
          </div> -->
        </div>
      </div>
    </div>
  </div>

  <div class="form-container">
    <form [formGroup]="recordForm" (ngSubmit)="onSubmit()" class="medical-form">
      <!-- Hiển thị thông báo lỗi -->
      <div class="alert alert-danger" *ngIf="errorMessage">
        <i class="fas fa-exclamation-circle"></i> {{errorMessage}}
      </div>
      
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-clipboard-list"></i>
          <h2>Thông tin khám bệnh</h2>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label>
              <i class="fas fa-exclamation-circle"></i>
              Triệu chứng
            </label>
            <textarea formControlName="symptoms" rows="3" placeholder="Mô tả các triệu chứng của bệnh nhân..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-history"></i>
              Tiền sử bệnh
            </label>
            <textarea formControlName="medicalHistory" rows="3" placeholder="Nhập tiền sử bệnh..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-allergies"></i>
              Dị ứng
            </label>
            <textarea formControlName="allergies" rows="2" placeholder="Liệt kê các dị ứng (nếu có)..."></textarea>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-stethoscope"></i>
          <h2>Kết quả khám</h2>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>
              <i class="fas fa-diagnoses"></i>
              Chẩn đoán
            </label>
            <textarea formControlName="diagnosis" rows="3" placeholder="Nhập chẩn đoán bệnh..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-flask"></i>
              Kết quả xét nghiệm
            </label>
            <textarea formControlName="testResults" rows="3" placeholder="Nhập kết quả xét nghiệm..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-prescription-bottle-alt"></i>
              Đơn thuốc
            </label>
            <textarea formControlName="prescription" rows="3" placeholder="Nhập đơn thuốc..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-sticky-note"></i>
              Ghi chú
            </label>
            <textarea formControlName="notes" rows="2" placeholder="Nhập ghi chú thêm..."></textarea>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" routerLink="/doctor/schedule">
          <i class="fas fa-arrow-left"></i>
          Quay lại
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="!recordForm.valid || isLoading">
          <i class="fas fa-save"></i>
          <span *ngIf="!isLoading">Lưu hồ sơ</span>
          <span *ngIf="isLoading">Đang lưu...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Success Popup -->
  <div class="popup-overlay" *ngIf="showSuccessPopup">
    <div class="popup-content">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3>Tạo hồ sơ thành công!</h3>
      <p>Đang chuyển hướng về trang danh sách lịch hẹn...</p>
      <div class="loading-bar">
        <div class="progress"></div>
      </div>
    </div>
  </div>
</div> 